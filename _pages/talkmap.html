---
layout: default
title: "Talk map"
permalink: /talkmap.html
---

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
  #talkmap { height: 600px; margin: 1rem 0; }
</style>

<h1>Talk locations</h1>
<div id="talkmap"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
  // Build a JS array of your talks from site.talks
  var talks = [
    {% for post in site.talks %}
      {
        title: {{ post.title | jsonify }},
        url: {{ post.url | relative_url | jsonify }},
        location_name: {{ post.location_name | jsonify }},
        lat: {{ post.latitude | default: 'null' }},
        lng: {{ post.longitude | default: 'null' }},
        date: {{ post.date | date: "%Y-%m-%d" | jsonify }}
      }{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ];

  // Create the map centered on Europe
  // - worldCopyJump: false -> we don't want automatic jumps to wrapped copies
  // - maxBoundsViscosity: 1.0 -> enforce the bounds when user tries to go beyond them
  var map = L.map('talkmap', { worldCopyJump: false, maxBoundsViscosity: 1.0 }).setView([54, 15], 4);

  // Restrict panning to roughly "Europe + most of the Pacific halves"
  // Longitudes: -170 (170°W) to 170 (170°E). Adjust if you want narrower/wider.
  map.setMaxBounds([
    [ -60.0, -170.0 ],   // SW corner  (lat, lng)
    [  85.0,  170.0 ]    // NE corner  (lat, lng)
  ]);

  // English-only basemap (Carto Light). noWrap prevents tile-wrap.
  L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://www.carto.com/">CARTO</a>',
    subdomains: 'abcd',
    maxZoom: 19,
    noWrap: true
  }).addTo(map);

  var markers = [];
  talks.forEach(function(t) {
    if (t.lat && t.lng) {
      var m = L.marker([t.lat, t.lng]).addTo(map);
      m.bindPopup(
        '<strong><a href="' + t.url + '">' + t.title + '</a></strong><br>' +
        (t.location_name ? t.location_name + '<br/>' : '') +
        (t.date ? t.date : '')
      );
      markers.push(m);
    } else {
      console.warn('Missing coords for:', t.title, t.location_name);
    }
  });

  if (markers.length) {
    var group = L.featureGroup(markers);
    map.fitBounds(group.getBounds().pad(0.2));
  }
</script>
